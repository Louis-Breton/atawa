document.addEventListener("DOMContentLoaded",function(){const WISHLIST_KEY="wishlist",drawerBody=document.querySelector('.drawer_body[wl="list"]'),emptyState=document.querySelector('[wl="empty"]'),cta=document.querySelector('[wl="cta"]'),label=document.querySelector('[wl="counter-label"]'),counterWrap=document.querySelector('[wl="counter-wrap"]'),cmsList=document.querySelector('[fs-cmsload-element="list"]');let wishlist=JSON.parse(localStorage.getItem(WISHLIST_KEY)||"[]");function syncLocalStorage(){try{localStorage.setItem(WISHLIST_KEY,JSON.stringify(wishlist))}catch(e){console.error("Erreur lors de l'accès au localStorage:",e)}}function updateCounter(){document.querySelectorAll('[wl="counter"]').forEach(e=>e.textContent=wishlist.length),updateLabel(),updateCounterWrap()}function updateCounterWrap(){counterWrap&&(counterWrap.style.display=0===wishlist.length?"none":"block")}function updateLabel(){const e=navigator.language||navigator.userLanguage,t=e.startsWith("fr"),n=wishlist.length,a=t?n<=1?"produit ajouté :":"produits ajoutés :":n<=1?"product:":"products:";label&&(label.textContent=` ${a}`)}function updateEmptyState(){0===wishlist.length?(emptyState.style.display="flex",cta.style.display="none"):(emptyState.style.display="none",cta.style.display="block")}function updateButtonState(){const e=navigator.language||navigator.userLanguage,t=e.startsWith("fr"),n={add:t?"Ajouter à ma wishlist":"Add to my wishlist",remove:t?"Retirer de ma wishlist":"Remove from my wishlist"};document.querySelectorAll('[wl="button"]').forEach(e=>{const t=e.getAttribute("wl-id"),a=wishlist.some(e=>e.id===t),o=e.querySelector('[wl="label"]');e.classList.toggle("is-active",a),e.setAttribute("data-tooltip",a?n.remove:n.add),e.setAttribute("aria-pressed",a),o&&(o.textContent=a?n.remove:n.add)})}function toggleWishlist(e){const t=e.closest('[wl="product"]'),n=e.getAttribute("wl-id"),a={id:n,name:t.querySelector('[wl="name"]').textContent,link:t.querySelector('[wl="link"]').getAttribute("href"),image:t.querySelector('[wl="image"]').getAttribute("src"),category:t.querySelector('[wl="category"]').textContent},o=wishlist.findIndex(e=>e.id===n);o>-1?wishlist.splice(o,1):wishlist.push(a),syncLocalStorage(),updateButtonState(),updateEmptyState(),renderWishlist(),updateCounter()}function removeFromWishlist(e){const t=wishlist.findIndex(t=>t.id===e);t>-1&&(wishlist.splice(t,1),syncLocalStorage(),updateButtonState(),renderWishlist(),updateCounter())}function renderWishlist(){drawerBody.innerHTML="",wishlist.forEach(e=>{const t=document.createElement("div");t.classList.add("wishlist_card"),t.setAttribute("wl-card","card");const n=document.createElement("div");n.classList.add("wishlist_card-image");const a=document.createElement("img");a.src=e.image,a.alt=e.name,a.classList.add("image-cover"),a.setAttribute("wl-card","image"),n.appendChild(a);const o=document.createElement("div");o.classList.add("wishlist_card-content");const r=document.createElement("p");r.classList.add("fs-9","text-neutral_400","text-style-ellipsis"),r.setAttribute("wl-card","category"),r.textContent=e.category;const i=document.createElement("a");i.href=e.link,i.classList.add("text-secondary_950-base","text-style-ellipsis"),i.setAttribute("wl-card","name-link"),i.textContent=e.name;const s=document.createElement("div");s.classList.add("wishlist_remove-product","w-embed"),s.setAttribute("wl-card","remove"),s.innerHTML='<svg aria-hidden="true" viewBox="0 0 24 24" fill="none" role="img" xmlns="http://www.w3.org/2000/svg"><path d="M5.5 5.5L12 12M12 12L18.5 18.5M12 12L5.5 18.5M12 12L18.5 5.5" stroke="currentColor" stroke-linecap="round" stroke-width="1.5" stroke-linejoin="round"></path></svg>',s.addEventListener("click",()=>removeFromWishlist(e.id)),o.appendChild(r),o.appendChild(i),o.appendChild(s),t.appendChild(n),t.appendChild(o),drawerBody.appendChild(t)}),updateEmptyState()}function attachWishlistEvents(){document.querySelectorAll('[wl="button"]').forEach(e=>{e.hasAttribute("data-wishlist-bound")||(e.setAttribute("data-wishlist-bound","true"),e.addEventListener("click",()=>toggleWishlist(e)))})}function observeLazyLoadedContent(){if(!cmsList)return;new MutationObserver(()=>{console.log("Nouveaux éléments détectés via lazy loading"),attachWishlistEvents(),updateButtonState()}).observe(cmsList,{childList:!0,subtree:!0})}attachWishlistEvents(),updateButtonState(),updateEmptyState(),updateCounter(),renderWishlist(),observeLazyLoadedContent()});
