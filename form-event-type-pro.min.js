!function(){const e="https://assets.atawa.com/form-event-type-source.json",t="RoleEventType",o="SelectedEventType";function n(){const e=document.querySelector('[event-type-pro="origine"]'),t=document.querySelector('[event-type-pro="destination"]');if(!e||!t)return;const o=e.options[0],n=o?.outerHTML||'<option value="">…</option>',r=o?.textContent||"";e.innerHTML=n,t.innerHTML="";const c=document.querySelector(".w-dropdown"),l=c?.querySelector(".w-dropdown-toggle");if(l){const e=l.querySelector("div");e&&(e.textContent=r),l.setAttribute("aria-expanded","false"),l.classList.remove("w--open")}c&&c.classList.remove("w--open");const s=c?.querySelector(".w-dropdown-list");s&&s.classList.remove("w--open")}function r(){n(),localStorage.removeItem(t),localStorage.removeItem(o)}function c(e,t,r){const c=document.querySelector('[event-type-pro="origine"]'),l=document.querySelector('[event-type-pro="destination"]');if(!c||!l)return console.error("UI manquante");n();const s=c.options[0],a=s?.textContent||"",i=document.createElement("a");i.href="#",i.className="dropdown_link w-dropdown-link",i.setAttribute("data-value",""),i.setAttribute("tabindex","0"),i.textContent=a,i.addEventListener("click",(e=>{e.preventDefault(),c.value="",localStorage.removeItem(o);const t=i.closest(".w-dropdown"),n=t.querySelector(".w-dropdown-toggle"),r=n.querySelector("div");r&&(r.textContent=a),t.classList.remove("w--open"),n.classList.remove("w--open"),n.setAttribute("aria-expanded","false"),t.querySelector(".w-dropdown-list").classList.remove("w--open")})),l.appendChild(i);const d=t.eventTypeOrderByProfile||{},u=t.eventTypeLabels||{},p=function(e,t){if(t in e)return t;const o=t.replace(/_/g,"-");if(o in e)return o;const n=t.replace(/-/g,"_");return n in e?n:null}(d,e);if(!p)return console.error(`Profil "${e}" introuvable`);const v=d[p];if(!Array.isArray(v))return console.error(`eventTypeOrderByProfile["${p}"] n'est pas un tableau`);v.forEach((e=>{const t=u[e]?.[r];if(!t)return void console.error(`Pas de label pour "${e}" en "${r}"`);const o=document.createElement("option");o.value=e,o.textContent=t,c.appendChild(o)}));const m=localStorage.getItem(o);if(m&&v.includes(m)){c.value=m;const e=u[m]?.[r],t=document.querySelector(".w-dropdown").querySelector(".w-dropdown-toggle").querySelector("div");t&&e&&(t.textContent=e)}v.forEach((e=>{const t=u[e]?.[r];if(!t)return;const n=document.createElement("a");n.href="#",n.className="dropdown_link w-dropdown-link",n.setAttribute("data-value",e),n.setAttribute("tabindex","0"),n.textContent=t,n.addEventListener("click",(r=>{r.preventDefault(),c.value=e,localStorage.setItem(o,e),c.dispatchEvent(new Event("change"));const l=n.closest(".w-dropdown"),s=l.querySelector(".w-dropdown-toggle"),a=s.querySelector("div");a&&(a.textContent=t),l.classList.remove("w--open"),s.classList.remove("w--open"),s.setAttribute("aria-expanded","false"),l.querySelector(".w-dropdown-list").classList.remove("w--open")})),n.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n.click())})),l.appendChild(n)}))}document.addEventListener("DOMContentLoaded",(function(){const n=window.location.pathname.startsWith("/en")?"en":"fr";fetch(e,{cache:"no-store"}).then((e=>{if(!e.ok)throw new Error(`Échec fetch (${e.status})`);return e.json()})).then((e=>{!function(e,n){document.querySelectorAll("[role-event-type]").forEach((r=>{r.addEventListener("click",(()=>{const l=r.getAttribute("role-event-type");if(!l)return console.error("role-event-type manquant");localStorage.setItem(t,l),localStorage.removeItem(o),c(l,e,n)}))}));const l=document.querySelector('[form-element="reset-btn"]');l&&l.addEventListener("click",r);const s=document.querySelector('[event-type-pro="origine"]');s&&s.addEventListener("change",(()=>{const e=s.value;e&&localStorage.setItem(o,e)}))}(e,n);const l=localStorage.getItem(t);l&&c(l,e,n)})).catch((e=>console.error("Erreur fetch event types →",e)))}))}();
