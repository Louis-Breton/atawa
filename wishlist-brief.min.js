document.addEventListener("DOMContentLoaded",(function(){const e="wishlist",t=document.querySelector('[wl-page="list"]'),n=document.querySelector("#wishlist-card-template"),o=document.querySelector(".wishlist_section"),r=document.querySelector("#brief-pro-wishlist-category"),i=document.querySelector("#brief-pro-wishlist-product"),s=document.querySelector("#brief-private-wishlist-category"),a=document.querySelector("#brief-private-wishlist-product"),c=document.querySelector('[wl-page="counter-label"]'),l=(navigator.language||navigator.userLanguage).startsWith("en");let u;try{u=JSON.parse(localStorage.getItem(e))||[]}catch(e){console.error("Erreur lors du chargement de la wishlist :",e),u=[]}function d(){console.log("Synchronizing wishlist:",u),localStorage.setItem(e,JSON.stringify(u)),function(){const e=new CustomEvent("wishlist:updated",{detail:{wishlist:u}});document.dispatchEvent(e)}()}function m(){document.querySelectorAll('[wl="counter"]').forEach((e=>{e.textContent=u.length}))}function h(){const e=u.length;c&&(c.textContent=l?1===e?"product in your wishlist":"products in your wishlist":1===e?"produit dans votre wishlist":"produits dans votre wishlist")}function y(){o.style.display=0===u.length?"none":"block"}function p(){const e=Array.from(new Set(u.map((e=>e.category)))).join(", "),t=u.map((e=>`${e.quantity||1} ${e.name}`)).join(", ");s&&(s.value=e),a&&(a.value=t),r&&(r.value=e),i&&(i.value=t),console.log("Champs wishlist mis à jour :",{categories:e,products:t})}function g(e,t,n,o,r,i){let s,a=300;const c=()=>{let e=parseInt(n.textContent,10);"decrease"===t&&e>r?e--:"increase"===t&&e<i&&e++,n.textContent=e,function(e,t){const n=u.find((t=>t.id===e));n&&(n.quantity=t,d(),m(),p(),h())}(o,e)},l=()=>{c(),a=Math.max(a-30,30),s=setTimeout(l,a)},y=e=>{e.preventDefault(),a=300,c(),s=setTimeout(l,a)},g=()=>clearTimeout(s);e.addEventListener("mousedown",y),e.addEventListener("touchstart",y),document.addEventListener("mouseup",g),document.addEventListener("touchend",g),document.addEventListener("mouseleave",g)}!function e(){console.log("Rendering wishlist with items:",u),t&&n?(t.innerHTML="",0!==u.length?u.forEach((o=>{const r=n.content.cloneNode(!0),i=r.querySelector('[wl-card="image"]'),s=r.querySelector('[wl-card="category"]'),a=r.querySelector('[wl-card="name-link"]'),c=r.querySelector('[quantity="value"]'),l=r.querySelector('[wl-card="remove"]');if(!(i&&s&&a&&c&&l))return void console.error("Problème avec le template : certains éléments sont manquants.");i.src=o.image,i.alt=o.name,s.textContent=o.category,a.textContent=o.name,c.textContent=o.quantity||1,l.addEventListener("click",(()=>{u=u.filter((e=>e.id!==o.id)),d(),e(),y(),m(),p(),h()}));const w=r.querySelector('[quantity="decrease"]'),v=r.querySelector('[quantity="increase"]'),q=c.closest('[quantity="input"]'),f=parseInt(q.dataset.min,10)||1,S=parseInt(q.dataset.max,10)||999;g(w,"decrease",c,o.id,f,S),g(v,"increase",c,o.id,f,S),t.appendChild(r)})):t.innerHTML="<p>Aucun produit dans la wishlist.</p>"):console.error("Conteneur wishlist ou template introuvable !")}(),m(),y(),p(),h()}));
