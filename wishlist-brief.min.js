document.addEventListener("DOMContentLoaded",function(){const e="wishlist",t=document.querySelector('[wl-page="list"]'),n=document.querySelector("#wishlist-card-template"),a=document.querySelector(".wishlist_section"),r=document.querySelector("#brief-pro-wishlist"),o=document.querySelector("#brief-private-wishlist"),l="https://www.atawa.com/catalogue";if(!t||!n)return void console.warn("Conteneur wishlist ou template introuvable sur cette page.");let c=JSON.parse(localStorage.getItem(e)||"[]");function i(){localStorage.setItem(e,JSON.stringify(c))}function u(e){return c.find(t=>t.id===e)}function d(){a.style.display=c.length===0?"none":"block"}function s(){let e=`${c.length} produits enregistrés dans la wishlist :\n\n`;c.forEach(t=>{e+=`(${t.category})\n[${t.quantity||1}] ${t.name}\n${l}${t.link}\n—\n`}),e=e.trimEnd().replace(/—$/,""),r&&(r.value=e),o&&(o.value=e)}function m(e,t){const n=u(e);n&&(n.quantity=t,i(),s())}function p(e,t,n,a,r,o){let l,c=300,i=30,u=30,d=()=>{let d=parseInt(n.textContent,10);t==="decrease"&&d>r?d--:t==="increase"&&d<o&&d++,n.textContent=d,m(a,d)},s=()=>{d(),c=Math.max(c-i,u),l=setTimeout(s,c)},p=t=>{t.preventDefault(),c=300,d(),l=setTimeout(s,c)},f=()=>{clearTimeout(l)};e.addEventListener("mousedown",p),e.addEventListener("touchstart",p),document.addEventListener("mouseup",f),document.addEventListener("touchend",f),document.addEventListener("mouseleave",f)}function f(){t.innerHTML="",c.forEach(e=>{const a=n.content.cloneNode(!0);a.querySelector('[wl-card="image"]').src=e.image,a.querySelector('[wl-card="image"]').alt=e.name,a.querySelector('[wl-card="category"]').textContent=e.category,a.querySelector('[wl-card="name-link"]').textContent=e.name;const r=a.querySelector('[quantity="value"]');r.textContent=e.quantity||1;const o=a.querySelector('[wl-card="remove"]');o.addEventListener("click",()=>{c=c.filter(t=>t.id!==e.id),i(),f(),d(),s()});const l=a.querySelector('[quantity="decrease"]'),u=a.querySelector('[quantity="increase"]'),m=r.closest('[quantity="input"]'),h=parseInt(m.dataset.min,10)||1,g=parseInt(m.dataset.max,10)||999;p(l,"decrease",r,e.id,h,g),p(u,"increase",r,e.id,h,g),t.appendChild(a)}),c.length===0&&(t.innerHTML="<p>Aucun produit dans la wishlist.</p>"),d(),s()}f()});
