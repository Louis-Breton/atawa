document.addEventListener("DOMContentLoaded",function(){const t="wishlist",e=document.querySelector('[wl-page="list"]'),n=document.querySelector("#wishlist-card-template"),o=document.querySelector(".wishlist_section"),i=document.querySelector("#brief-pro-wishlist"),r=document.querySelector("#brief-private-wishlist"),c="https://www.atawa.com/catalogue",a=document.querySelector('[wl-page="counter-label"]'),l=navigator.language||navigator.userLanguage,s=l.startsWith("en");let d;try{d=JSON.parse(localStorage.getItem(t))||[]}catch(t){console.error("Erreur lors du chargement de la wishlist :",t),d=[]}function u(){console.log("Synchronizing wishlist:",d),localStorage.setItem(t,JSON.stringify(d)),m()}function m(){const t=new CustomEvent("wishlist:updated",{detail:{wishlist:d}});document.dispatchEvent(t)}function y(){document.querySelectorAll('[wl="counter"]').forEach(t=>{t.textContent=d.length})}function p(){const t=d.length;a&&(a.textContent=s?1===t?"product in your wishlist":"products in your wishlist":1===t?"produit dans votre wishlist":"produits dans votre wishlist")}function h(){o.style.display=0===d.length?"none":"block"}function w(){let t=`${d.length} produits enregistrés dans la wishlist :\n\n`;d.forEach(e=>{t+=`(${e.category})\n`,t+=`[${e.quantity||1}] ${e.name}\n`,t+=`${c}${e.link}\n`,t+="—\n"}),t=t.trimEnd().replace(/—$/,""),i&&(i.value=t),r&&(r.value=t)}function f(t,e){const n=d.find(n=>n.id===t);n&&(n.quantity=e,u(),y(),w(),p())}function v(t,e,n,o,i,r){let c,a=300,l=30,s=30;const d=()=>{let t=parseInt(n.textContent,10);"decrease"===e&&t>i?t--:"increase"===e&&t<r&&t++,n.textContent=t,f(o,t)},u=()=>{d(),a=Math.max(a-l,s),c=setTimeout(u,a)},m=t=>{t.preventDefault(),a=300,d(),c=setTimeout(u,a)},y=()=>clearTimeout(c);t.addEventListener("mousedown",m),t.addEventListener("touchstart",m),document.addEventListener("mouseup",y),document.addEventListener("touchend",y),document.addEventListener("mouseleave",y)}function g(){if(console.log("Rendering wishlist with items:",d),!e||!n)return void console.error("Conteneur wishlist ou template introuvable !");if(e.innerHTML="",0===d.length)return void(e.innerHTML="<p>Aucun produit dans la wishlist.</p>");d.forEach(t=>{const o=n.content.cloneNode(!0),i=o.querySelector('[wl-card="image"]'),r=o.querySelector('[wl-card="category"]'),c=o.querySelector('[wl-card="name-link"]'),a=o.querySelector('[quantity="value"]'),l=o.querySelector('[wl-card="remove"]');if(!i||!r||!c||!a||!l)return void console.error("Problème avec le template : certains éléments sont manquants.");i.src=t.image,i.alt=t.name,r.textContent=t.category,c.textContent=t.name,a.textContent=t.quantity||1,l.addEventListener("click",()=>{d=d.filter(e=>e.id!==t.id),u(),g(),h(),y(),w(),p()});const s=o.querySelector('[quantity="decrease"]'),m=o.querySelector('[quantity="increase"]'),f=a.closest('[quantity="input"]'),x=parseInt(f.dataset.min,10)||1,E=parseInt(f.dataset.max,10)||999;v(s,"decrease",a,t.id,x,E),v(m,"increase",a,t.id,x,E),e.appendChild(o)})}g(),y(),h(),w(),p(),document.addEventListener("submit",t=>{const e=t.target;if(e.querySelector('input[data-name="brief-pro-civilite"]')||e.querySelector('input[data-name="brief-private-civilite"]')){t.preventDefault();const n=e.querySelector('input[type="radio"]:checked'),o=n?n.value:"",i=e.querySelector('input[name="brief-pro-nom"], input[name="brief-private-nom"]'),r=i?i.value:"";o&&r&&(localStorage.setItem("formCivilite",o),localStorage.setItem("formNom",r))}})});
